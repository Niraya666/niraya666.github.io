<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Agent Infra: sandbox技术和选型 | LZY Blog</title>
<meta name="keywords" content="Agent-Infra, Agent">
<meta name="description" content="背景: 从Context Engineering 角度出发

在量子力学中，希尔伯特空间内的任何复杂量子态，本质上都是一组正交完备基矢的线性叠加

在过去我们总是以为，只要给LLM足够多的tools，则agent就更强大，但事实总是事与愿违，工具并非越多越好，过多的工具，会降低使用准确率和浪费宝贵的上下文，也就是 Context Rot； 于是乎，有了一个新的领域：Context Engineering。
根据业界领先的context Engineering的经验：


Cursor 的 &ldquo;File-based Tools&rdquo;： Cursor 采取了一种文档化方案，将工具的“说明书”全部文件化。当 Agent 需要使用某个能力时，它会先通过Retrieval找到对应的文档，阅读后生成代码


Manus 的 &ldquo;Context Offloading&rdquo;： 在 Manus 的设计中，采用了层级化的工具架构。为了应对复杂的长流程任务，Agent 不再试图把所有中间状态都记在 Context Window 里，而是利用文件系统进行 Context Offloading（上下文卸载）。文件系统成为了 Agent 的外挂memory（不同于compact的有损压缩，Offloading是无损的）


Anthropic 的 &ldquo;Programming tool-using&rdquo; 和skills：由agent自身编写代码实现tool-call相比于直接的tool-call能够节约大量context；同时agent skills本质上也是利用了file-system，对宝贵的context 进行节约的设计


显而易见，代码执行环境 (Code Execution) 和 可读写的文件系统 (File System) 已经超越了辅助工具的范畴，成为 Agent 组件中必要且不可或缺的部分。
しかし赋予 Agent “写代码”和“改文件”的能力，等同于赋予了它巨大的破坏力。
与传统软件确定的执行路径不同，Agent 的行为是基于概率和上下文动态生成的
意味着：


Prompt Injection


Agent 的幻觉导致死循环或资源耗尽


因此，通过为 Agent 划定严格的 安全边界（Sandbox）——如网络隔离、文件系统隔离、进程隔离，便显得尤为重要。
此外与 Claude Code 这样跑在开发者本地电脑上的 Coding Agent 不同，开发者通常拥有把控风险的能力（虽然在 &ldquo;YOLO 模式&rdquo; 下误删文件的事故屡见不鲜）；对于部署在云端的 Agent 服务，这两者存在着信任边界的差异，用户不希望为 Agent 的每一次执行 点击“批准”，只要 Agent 在sandbox内折腾，它就是安全的；">
<meta name="author" content="Theme PaperMod">
<link rel="canonical" href="https://niraya666.github.io/posts/agent-infra-sandbox%E6%8A%80%E6%9C%AF%E5%92%8C%E9%80%89%E5%9E%8B/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://niraya666.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://niraya666.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://niraya666.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://niraya666.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://niraya666.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://niraya666.github.io/posts/agent-infra-sandbox%E6%8A%80%E6%9C%AF%E5%92%8C%E9%80%89%E5%9E%8B/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Agent Infra: sandbox技术和选型" />
<meta property="og:description" content="背景: 从Context Engineering 角度出发

在量子力学中，希尔伯特空间内的任何复杂量子态，本质上都是一组正交完备基矢的线性叠加

在过去我们总是以为，只要给LLM足够多的tools，则agent就更强大，但事实总是事与愿违，工具并非越多越好，过多的工具，会降低使用准确率和浪费宝贵的上下文，也就是 Context Rot； 于是乎，有了一个新的领域：Context Engineering。
根据业界领先的context Engineering的经验：


Cursor 的 &ldquo;File-based Tools&rdquo;： Cursor 采取了一种文档化方案，将工具的“说明书”全部文件化。当 Agent 需要使用某个能力时，它会先通过Retrieval找到对应的文档，阅读后生成代码


Manus 的 &ldquo;Context Offloading&rdquo;： 在 Manus 的设计中，采用了层级化的工具架构。为了应对复杂的长流程任务，Agent 不再试图把所有中间状态都记在 Context Window 里，而是利用文件系统进行 Context Offloading（上下文卸载）。文件系统成为了 Agent 的外挂memory（不同于compact的有损压缩，Offloading是无损的）


Anthropic 的 &ldquo;Programming tool-using&rdquo; 和skills：由agent自身编写代码实现tool-call相比于直接的tool-call能够节约大量context；同时agent skills本质上也是利用了file-system，对宝贵的context 进行节约的设计


显而易见，代码执行环境 (Code Execution) 和 可读写的文件系统 (File System) 已经超越了辅助工具的范畴，成为 Agent 组件中必要且不可或缺的部分。
しかし赋予 Agent “写代码”和“改文件”的能力，等同于赋予了它巨大的破坏力。
与传统软件确定的执行路径不同，Agent 的行为是基于概率和上下文动态生成的
意味着：


Prompt Injection


Agent 的幻觉导致死循环或资源耗尽


因此，通过为 Agent 划定严格的 安全边界（Sandbox）——如网络隔离、文件系统隔离、进程隔离，便显得尤为重要。
此外与 Claude Code 这样跑在开发者本地电脑上的 Coding Agent 不同，开发者通常拥有把控风险的能力（虽然在 &ldquo;YOLO 模式&rdquo; 下误删文件的事故屡见不鲜）；对于部署在云端的 Agent 服务，这两者存在着信任边界的差异，用户不希望为 Agent 的每一次执行 点击“批准”，只要 Agent 在sandbox内折腾，它就是安全的；" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://niraya666.github.io/posts/agent-infra-sandbox%E6%8A%80%E6%9C%AF%E5%92%8C%E9%80%89%E5%9E%8B/" />
<meta property="og:image" content="https://niraya666.github.io/images/papermod-cover.png" />
<meta property="article:section" content="posts" />
<meta property="article:published_time" content="2026-01-26T21:55:00+08:00" />
<meta property="article:modified_time" content="2026-01-26T21:55:00+08:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://niraya666.github.io/images/papermod-cover.png" />
<meta name="twitter:title" content="Agent Infra: sandbox技术和选型"/>
<meta name="twitter:description" content="背景: 从Context Engineering 角度出发

在量子力学中，希尔伯特空间内的任何复杂量子态，本质上都是一组正交完备基矢的线性叠加

在过去我们总是以为，只要给LLM足够多的tools，则agent就更强大，但事实总是事与愿违，工具并非越多越好，过多的工具，会降低使用准确率和浪费宝贵的上下文，也就是 Context Rot； 于是乎，有了一个新的领域：Context Engineering。
根据业界领先的context Engineering的经验：


Cursor 的 &ldquo;File-based Tools&rdquo;： Cursor 采取了一种文档化方案，将工具的“说明书”全部文件化。当 Agent 需要使用某个能力时，它会先通过Retrieval找到对应的文档，阅读后生成代码


Manus 的 &ldquo;Context Offloading&rdquo;： 在 Manus 的设计中，采用了层级化的工具架构。为了应对复杂的长流程任务，Agent 不再试图把所有中间状态都记在 Context Window 里，而是利用文件系统进行 Context Offloading（上下文卸载）。文件系统成为了 Agent 的外挂memory（不同于compact的有损压缩，Offloading是无损的）


Anthropic 的 &ldquo;Programming tool-using&rdquo; 和skills：由agent自身编写代码实现tool-call相比于直接的tool-call能够节约大量context；同时agent skills本质上也是利用了file-system，对宝贵的context 进行节约的设计


显而易见，代码执行环境 (Code Execution) 和 可读写的文件系统 (File System) 已经超越了辅助工具的范畴，成为 Agent 组件中必要且不可或缺的部分。
しかし赋予 Agent “写代码”和“改文件”的能力，等同于赋予了它巨大的破坏力。
与传统软件确定的执行路径不同，Agent 的行为是基于概率和上下文动态生成的
意味着：


Prompt Injection


Agent 的幻觉导致死循环或资源耗尽


因此，通过为 Agent 划定严格的 安全边界（Sandbox）——如网络隔离、文件系统隔离、进程隔离，便显得尤为重要。
此外与 Claude Code 这样跑在开发者本地电脑上的 Coding Agent 不同，开发者通常拥有把控风险的能力（虽然在 &ldquo;YOLO 模式&rdquo; 下误删文件的事故屡见不鲜）；对于部署在云端的 Agent 服务，这两者存在着信任边界的差异，用户不希望为 Agent 的每一次执行 点击“批准”，只要 Agent 在sandbox内折腾，它就是安全的；"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://niraya666.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Agent Infra: sandbox技术和选型",
      "item": "https://niraya666.github.io/posts/agent-infra-sandbox%E6%8A%80%E6%9C%AF%E5%92%8C%E9%80%89%E5%9E%8B/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Agent Infra: sandbox技术和选型",
  "name": "Agent Infra: sandbox技术和选型",
  "description": "背景: 从Context Engineering 角度出发 在量子力学中，希尔伯特空间内的任何复杂量子态，本质上都是一组正交完备基矢的线性叠加\n在过去我们总是以为，只要给LLM足够多的tools，则agent就更强大，但事实总是事与愿违，工具并非越多越好，过多的工具，会降低使用准确率和浪费宝贵的上下文，也就是 Context Rot； 于是乎，有了一个新的领域：Context Engineering。\n根据业界领先的context Engineering的经验：\nCursor 的 \u0026ldquo;File-based Tools\u0026rdquo;： Cursor 采取了一种文档化方案，将工具的“说明书”全部文件化。当 Agent 需要使用某个能力时，它会先通过Retrieval找到对应的文档，阅读后生成代码\nManus 的 \u0026ldquo;Context Offloading\u0026rdquo;： 在 Manus 的设计中，采用了层级化的工具架构。为了应对复杂的长流程任务，Agent 不再试图把所有中间状态都记在 Context Window 里，而是利用文件系统进行 Context Offloading（上下文卸载）。文件系统成为了 Agent 的外挂memory（不同于compact的有损压缩，Offloading是无损的）\nAnthropic 的 \u0026ldquo;Programming tool-using\u0026rdquo; 和skills：由agent自身编写代码实现tool-call相比于直接的tool-call能够节约大量context；同时agent skills本质上也是利用了file-system，对宝贵的context 进行节约的设计\n显而易见，代码执行环境 (Code Execution) 和 可读写的文件系统 (File System) 已经超越了辅助工具的范畴，成为 Agent 组件中必要且不可或缺的部分。\nしかし赋予 Agent “写代码”和“改文件”的能力，等同于赋予了它巨大的破坏力。\n与传统软件确定的执行路径不同，Agent 的行为是基于概率和上下文动态生成的\n意味着：\nPrompt Injection\nAgent 的幻觉导致死循环或资源耗尽\n因此，通过为 Agent 划定严格的 安全边界（Sandbox）——如网络隔离、文件系统隔离、进程隔离，便显得尤为重要。\n此外与 Claude Code 这样跑在开发者本地电脑上的 Coding Agent 不同，开发者通常拥有把控风险的能力（虽然在 \u0026ldquo;YOLO 模式\u0026rdquo; 下误删文件的事故屡见不鲜）；对于部署在云端的 Agent 服务，这两者存在着信任边界的差异，用户不希望为 Agent 的每一次执行 点击“批准”，只要 Agent 在sandbox内折腾，它就是安全的；\n",
  "keywords": [
    "Agent-Infra", "Agent"
  ],
  "articleBody": "背景: 从Context Engineering 角度出发 在量子力学中，希尔伯特空间内的任何复杂量子态，本质上都是一组正交完备基矢的线性叠加\n在过去我们总是以为，只要给LLM足够多的tools，则agent就更强大，但事实总是事与愿违，工具并非越多越好，过多的工具，会降低使用准确率和浪费宝贵的上下文，也就是 Context Rot； 于是乎，有了一个新的领域：Context Engineering。\n根据业界领先的context Engineering的经验：\nCursor 的 “File-based Tools”： Cursor 采取了一种文档化方案，将工具的“说明书”全部文件化。当 Agent 需要使用某个能力时，它会先通过Retrieval找到对应的文档，阅读后生成代码\nManus 的 “Context Offloading”： 在 Manus 的设计中，采用了层级化的工具架构。为了应对复杂的长流程任务，Agent 不再试图把所有中间状态都记在 Context Window 里，而是利用文件系统进行 Context Offloading（上下文卸载）。文件系统成为了 Agent 的外挂memory（不同于compact的有损压缩，Offloading是无损的）\nAnthropic 的 “Programming tool-using” 和skills：由agent自身编写代码实现tool-call相比于直接的tool-call能够节约大量context；同时agent skills本质上也是利用了file-system，对宝贵的context 进行节约的设计\n显而易见，代码执行环境 (Code Execution) 和 可读写的文件系统 (File System) 已经超越了辅助工具的范畴，成为 Agent 组件中必要且不可或缺的部分。\nしかし赋予 Agent “写代码”和“改文件”的能力，等同于赋予了它巨大的破坏力。\n与传统软件确定的执行路径不同，Agent 的行为是基于概率和上下文动态生成的\n意味着：\nPrompt Injection\nAgent 的幻觉导致死循环或资源耗尽\n因此，通过为 Agent 划定严格的 安全边界（Sandbox）——如网络隔离、文件系统隔离、进程隔离，便显得尤为重要。\n此外与 Claude Code 这样跑在开发者本地电脑上的 Coding Agent 不同，开发者通常拥有把控风险的能力（虽然在 “YOLO 模式” 下误删文件的事故屡见不鲜）；对于部署在云端的 Agent 服务，这两者存在着信任边界的差异，用户不希望为 Agent 的每一次执行 点击“批准”，只要 Agent 在sandbox内折腾，它就是安全的；\n技术实现比较 技术方案 核心原理 启动速度 隔离强度 典型适用场景 Local Runtime OS 原语 (bubblewrap) 极快 (ms级) 低 本地开发、CLI 工具 WASM 字节码沙箱 微秒级 中 简单的纯计算任务 Docker (Standard) 进程级 (Cgroups/NS) 快 (s级) 中 通用任务，需深度加固 gVisor 内核模拟 (Sentry) 中 (s级) 高 多租户、不可信代码执行 MicroVM (Firecracker) 硬件虚拟化 (KVM) 极快 (~125ms) 极高 公有云、高密度 Agent 托管 从技术实现角度，现阶段的Sandbox有以下几种实现方式\nLocal Sandbox-runtime 其原理利用 Linux 的 namespaces 和 cgroups 或 macOS 的 sandbox-exec 等操作系统原语直接限制进程权限， 如限制对配置路径的读/写访问，通过内置代理路由网络流量。\n优点：极轻量，无镜像拉取开销，适合用户的本地开发环境。\n缺点：依赖宿主内核，如果内核存在漏洞，恶意代码可能逃逸。\n如 Claude Code 中 执行 /sandbox\n可在 .claude/settings.json 中配置对应的权限：\n{ \"sandbox\": { \"enabled\": true, \"autoAllowBashIfSandboxed\": true, \"excludedCommands\": [\"git\", \"docker\"], \"network\": { \"allowUnixSockets\": [\"/var/run/docker.sock\"], \"allowLocalBinding\": true } } } 本质上，Claude Code 的 sandbox runtime 是一个 OS 级别的“受限 Bash 运行环境”。\n对 Claude code 发出的 bash 命令及其所有子进程统一施加：\n文件系统隔离（只允许访问/写入你事先配置的目录）；\n网络隔离（只允许访问你事先配置的域名/IP，通常通过本地 proxy/过滤实现）\n好消息是，Anthropic 将这个sandbox开源了，通过：\nnpx @anthropic-ai/sandbox-runtime 使用，不只只能给CC使用的，也可用于自己的agent项目中，通过MCP的方式配置使用。\n具体可见：anthropic-experimental/sandbox-runtime\n不过，macOS 的 sandbox-exec 基本上处于废弃状态，建议谨慎使用。\nWebAssembly (WASM) WASM 最初是为浏览器设计的，天生具有沙箱属性。\nWASM 将代码编译成通用的二进制格式（.wasm）。Runtime 会像显微镜一样检查每一条指令，确保它只能访问分配给它的那块内存数组。越界访问会被立即掐断。\nWASM 的冷启动时间极快， 成本低，适合执行简单逻辑的场景。\n但其生态兼容性是最大痛点。虽然 Python 可以编译为 WASM (Pyodide)，但许多依赖 C 扩展的库（如 Pandas, NumPy, Scipy 的某些部分）支持尚不完善，且网络栈受限\nDocker 默认的 Docker 是不安全的，在标准 Docker 中，容器只是宿主机上的一个进程。\n存在容器逃逸的问题： Linux 内核由数千万行代码组成，不可避免地存在 Bug（漏洞）。如果 Agent 发送了一个精心构造的“恶意系统调用”触发了内核漏洞（Kernel Panic 或 提权漏洞），它就能瞬间逃出容器，直接控制整台宿主机。\n因此必须进行安全加固。\ndocker run \\ --cap-drop ALL \\ --security-opt no-new-privileges \\ --security-opt seccomp=/path/to/seccomp-profile.json \\ --read-only \\ --tmpfs /tmp:rw,noexec,nosuid,size=100m \\ --tmpfs /home/agent:rw,noexec,nosuid,size=500m \\ --network none \\ --memory 2g \\ --cpus 2 \\ --pids-limit 100 \\ --user 1000:1000 \\ -v /path/to/code:/workspace:ro \\ -v /var/run/proxy.sock:/var/run/proxy.sock:ro \\ agent-image 关键配置包括移除 Linux capabilities、只读文件系统、禁用网络接口等\n选项 目的 --cap-drop ALL 删除 Linux 功能，如 NET_ADMIN 和 SYS_ADMIN，这些功能可能导致权限提升 --security-opt no-new-privileges 防止进程通过 setuid 二进制文件获得权限 --security-opt seccomp=... 限制可用的系统调用；Docker 的默认值阻止约 44 个，自定义配置文件可以阻止更多 --read-only 使容器的根文件系统不可变，防止代理持久化更改 --tmpfs /tmp:... 提供一个可写的临时目录，在容器停止时清除 --network none 删除所有网络接口；代理通过下面挂载的 Unix 套接字进行通信 --memory 2g 将内存使用限制为 2GB 以防止资源耗尽 --pids-limit 100 限制进程数以防止 fork 炸弹 --user 1000:1000 以非 root 用户身份运行 -v ...:/workspace:ro 以只读方式挂载代码，以便代理可以分析但不能修改。避免挂载敏感的主机目录，如 ~/.ssh、~/.aws 或 ~/.config -v .../proxy.sock:... 挂载连接到在容器外运行的代理的 Unix 套接字 --userns-remap 将容器 root 映射到非特权主机用户；需要守护程序配置，但限制容器逃逸造成的损害 --ipc private 隔离进程间通信以防止跨容器攻击 （from Claude: Securely deploying AI agents）\ngVisor 标准docker容器共享主机内核，这意味着内核漏洞可能允许容器逃逸。\ngVisor 通过在用户空间中拦截系统调用来解决这个问题，然后才到达主机内核，实现自己的兼容性层来处理大多数系统调用，而无需涉及真实内核。\n简单来说，使用 gVisor，攻击面要小得多，恶意代码首先需要利用 gVisor 的用户空间实现，并且对真实内核的访问有限。不信任容器内的进程，不让它们直接接触真内核。\n流程对比：\nDocker: Agent -\u003e Syscall -\u003e 宿主机真内核\ngVisor: Agent -\u003e Syscall -\u003e Sentry (伪内核) -\u003e (检查并过滤) -\u003e 必要的 Syscall -\u003e 宿主机真内核\n要将 gVisor 与 Docker 一起使用，安装 runsc 运行时并配置守护程序：\n// /etc/docker/daemon.json { \"runtimes\": { \"runsc\": { \"path\": \"/usr/local/bin/runsc\" } } } 运行容器：\ndocker run --runtime=runsc agent-image 工作负载 开销 CPU 密集型计算 ~0%（无系统调用拦截） 简单系统调用 ~2 倍慢 文件 I/O 密集型 对于繁重的打开/关闭模式，最多慢 10-200 倍 计算密集型任务（如矩阵运算）几乎无损耗，但系统调用密集型任务（如大量小文件读写、网络请求）损耗显著， 对于多租户环境或处理不受信任的内容时，额外的隔离通常值得开销。\nMicroVM MicroVM 其的核心逻辑，是为了解决 Docker 无法解决的根本性矛盾：既要像容器一样快，又要像物理机一样安全。\nAWS 在 2018 年开源了 Firecracker，专为 Serverless 和多租户容器设计: 砍掉了传统虚拟机（如 QEMU）中 90% 对 Agent 无用的功能，只保留了 CPU、内存、网络和最基础的块设备， 因而带来了惊人的性能，约 125 毫秒的冷启动时间，内存开销不到 5 MiB。\n因此成为了目前公有云Sandbox 服务商，如E2B、Modal的底层标准技术。\n除了Firecracker以外：\nQEMU (Traditional VM)：功能更强但启动慢、内存占用高\nKata Containers：对外暴露 Docker/K8s 的操作接口，但对内它会启动一个轻量级虚拟机（支持调用 QEMU 或 Firecracker）来包裹容器\n如何选择： 分类维度 从工程落地角度，可以在以下几个维度做出权衡。\n自托管 (Self-hosting) vs 云服务 (Managed Provider) 并非所有企业的数据隐私要求都能够接受云托管的sandbox。拥有成熟运维团队的前提下，基于 Hardened Docker、gVisor 或 Kata Containers 自建集群都是不错的选择。\n当然，云托管解决了Firecracker 极度复杂的网络配置和资源调度，也让开发者能够将精力放在开发和快速验证上，更何况如E2B之类的sandbox服务商，已是不少agent项目（Manus、Perplexity等）的底层技术的一环。\nLong running vs High-frequency (Lifecycle， persistence) 现阶段的sandbox的最主要用途，还是 code Interpreter，如执行agent生成的代码、数据分析等。\n对于大多数情况下，用完即焚，每次请求启动一个全新环境，任务结束立即销毁。同时通过预装环境的sandbox（常用数据分析库）也可节约响应时间。\n在如Agent skills所需要file-system的场景下，持久化则显得很重要。像E2B也支持了一定时间内（30天内）的持久化：\nfrom e2b_code_interpreter import Sandbox sandbox = Sandbox.create() # Starts in Running state # Pause the sandbox sandbox.betaPause() # Running → Paused # Resume the sandbox sandbox.connect() # Running/Paused → Running # Kill the sandbox (from any state) sandbox.kill() # Running/Paused → Killed Serving vs Agentic RL Rollout 不同业务场景下的并发密度和Isolation要求不同。\nUser-facing Serving： 核心关注点在多租户隔离和响应延迟；因而，Firecracker 或 gVisor成为首选，同时通过Warm Pool预热机制以最大程度降低冷启动延迟。\nTraining \u0026 Data Gen： 这时候考虑的是Throughput和Cost；需要 Agent 在 Sandbox 中并行执行数万次代码，以生成用于 RLVR算法的奖励数据（Rollout）；此时docker已经足够（如 sandbox fusion）\nText-only vs GUI (Computer Use \u0026 Browser) Text-only (Code Interpreter)： 标准的 REPL 环境，仅涉及 stdin/stdout 和文件读写，基于轻量级 Linux 发行版和极低的资源消耗；\nGUI / Computer Use (Browser-using)： 需要VNC提供实时截屏于VLM，意味着更大的资源要求，和更复杂的数据传输；常见如[browserbase](https://www.browserbase.com/), steel-browser\n主流 Sandbox 方案汇总 通用sandbox（云服务）\nE2B\nmodel sandboxes\ndaytona\nAgentRun\nRunloop\ncloudflare-sandbox\nvercel-sandbox\n轻量级（开源）\nBoxLite\nMicrosandbox\nanthropic-experimental/sandbox-runtime\nagent-infra/sandbox\nBrowser-using\nsteel-browser\nBrowserbase\nbrowser-use-sandbox\n结语 起初OpenAI Code Interpreter 的出现， 需要一个安全的 Sandbox 来执行它生成的 Python 代码，仅仅为了弥补数学计算和逻辑执行的短板。\n随后， 随着 Context Engineering 的深入，Manus 和 Anthropic 的实践告诉我们，Sandbox 里的 File System 不再只是存临时文件的地方，它是 Agent 的memory，于是Sandbox 变成了 Agent Skills 和Memory 的载体。\n那么未来？是 Agent Using Sandbox，还是 Agent Inside Sandbox？\n参考 Beyond permission prompts: making Claude Code more secure and autonomous\nClaude Code: Sandboxing\nSecurely deploying AI agents\nsmolagents: Secure code execution\nDemystifying Agent Sandbox\n",
  "wordCount" : "663",
  "inLanguage": "en",
  "image": "https://niraya666.github.io/images/papermod-cover.png","datePublished": "2026-01-26T21:55:00+08:00",
  "dateModified": "2026-01-26T21:55:00+08:00",
  "author":{
    "@type": "Person",
    "name": "Theme PaperMod"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://niraya666.github.io/posts/agent-infra-sandbox%E6%8A%80%E6%9C%AF%E5%92%8C%E9%80%89%E5%9E%8B/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "LZY Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://niraya666.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://niraya666.github.io/" accesskey="h" title="LZY Blog (Alt + H)">LZY Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://niraya666.github.io/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://niraya666.github.io/posts/" title="AI">
                    <span>AI</span>
                </a>
            </li>
            <li>
                <a href="https://niraya666.github.io/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://niraya666.github.io/musik/" title="Musik!">
                    <span>Musik!</span>
                </a>
            </li>
            <li>
                <a href="https://niraya666.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://niraya666.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://niraya666.github.io/monthly/" title="月刊">
                    <span>月刊</span>
                </a>
            </li>
            <li>
                <a href="https://niraya666.github.io/essay/" title="杂文">
                    <span>杂文</span>
                </a>
            </li>
            <li>
                <a href="https://niraya666.github.io/travel/" title="游记">
                    <span>游记</span>
                </a>
            </li>
            <li>
                <a href="https://niraya666.github.io/travel-map/" title="足迹">
                    <span>足迹</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://niraya666.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://niraya666.github.io/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Agent Infra: sandbox技术和选型
      <span class="entry-hint" title="Draft">
        <svg xmlns="http://www.w3.org/2000/svg" height="35" viewBox="0 -960 960 960" fill="currentColor">
          <path
            d="M160-410v-60h300v60H160Zm0-165v-60h470v60H160Zm0-165v-60h470v60H160Zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22q0 11-4.5 22.5T862.09-380L643-160H520Zm300-263-37-37 37 37ZM580-220h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z" />
        </svg>
      </span>
    </h1>
    <div class="post-meta"><span title='2026-01-26 21:55:00 +0800 CST'>January 26, 2026</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Theme PaperMod

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e8%83%8c%e6%99%af-%e4%bb%8econtext-engineering-%e8%a7%92%e5%ba%a6%e5%87%ba%e5%8f%91" aria-label="背景: 从Context Engineering 角度出发">背景: 从Context Engineering 角度出发</a></li>
                <li>
                    <a href="#%e6%8a%80%e6%9c%af%e5%ae%9e%e7%8e%b0%e6%af%94%e8%be%83" aria-label="技术实现比较">技术实现比较</a><ul>
                        
                <li>
                    <a href="#local-sandbox-runtime" aria-label="Local Sandbox-runtime">Local Sandbox-runtime</a></li>
                <li>
                    <a href="#webassembly-wasm" aria-label="WebAssembly (WASM)">WebAssembly (WASM)</a></li>
                <li>
                    <a href="#docker" aria-label="Docker">Docker</a></li>
                <li>
                    <a href="#gvisor" aria-label="gVisor">gVisor</a></li>
                <li>
                    <a href="#microvm" aria-label="MicroVM">MicroVM</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%a6%82%e4%bd%95%e9%80%89%e6%8b%a9-%e5%88%86%e7%b1%bb%e7%bb%b4%e5%ba%a6" aria-label="如何选择： 分类维度">如何选择： 分类维度</a><ul>
                        
                <li>
                    <a href="#%e8%87%aa%e6%89%98%e7%ae%a1-self-hosting-vs-%e4%ba%91%e6%9c%8d%e5%8a%a1-managed-provider" aria-label="自托管 (Self-hosting) vs 云服务 (Managed Provider)">自托管 (Self-hosting) vs 云服务 (Managed Provider)</a></li>
                <li>
                    <a href="#long-running-vs-high-frequency-lifecycle-persistence" aria-label="Long running vs High-frequency (Lifecycle， persistence)">Long running vs High-frequency (Lifecycle， persistence)</a></li>
                <li>
                    <a href="#serving-vs-agentic-rl-rollout" aria-label="Serving vs Agentic RL Rollout">Serving vs Agentic RL Rollout</a></li>
                <li>
                    <a href="#text-only-vs-gui-computer-use--browser" aria-label="Text-only vs GUI (Computer Use &amp; Browser)">Text-only vs GUI (Computer Use &amp; Browser)</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%b8%bb%e6%b5%81-sandbox-%e6%96%b9%e6%a1%88%e6%b1%87%e6%80%bb" aria-label="主流 Sandbox 方案汇总">主流 Sandbox 方案汇总</a></li>
                <li>
                    <a href="#%e7%bb%93%e8%af%ad" aria-label="结语">结语</a></li>
                <li>
                    <a href="#%e5%8f%82%e8%80%83" aria-label="参考">参考</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="背景-从context-engineering-角度出发">背景: 从Context Engineering 角度出发<a hidden class="anchor" aria-hidden="true" href="#背景-从context-engineering-角度出发">#</a></h2>
<blockquote>
<p>在量子力学中，希尔伯特空间内的任何复杂<strong>量子态</strong>，本质上都是一组<strong>正交完备基矢</strong>的线性叠加</p>
</blockquote>
<p>在过去我们总是以为，只要给LLM足够多的tools，则agent就更强大，但事实总是事与愿违，工具并非越多越好，过多的工具，会降低使用准确率和浪费宝贵的上下文，也就是 <strong>Context Rot；</strong> 于是乎，有了一个新的领域：<strong>Context Engineering。</strong></p>
<p>根据业界领先的context Engineering的经验：</p>
<ul>
<li>
<p><strong>Cursor 的 &ldquo;File-based Tools&rdquo;</strong>： Cursor 采取了一种文档化方案，将工具的“说明书”全部文件化。当 Agent 需要使用某个能力时，它会先通过Retrieval找到对应的文档，阅读后生成代码</p>
</li>
<li>
<p><strong>Manus 的 &ldquo;Context Offloading&rdquo;</strong>： 在 Manus 的设计中，采用了层级化的工具架构。为了应对复杂的长流程任务，Agent 不再试图把所有中间状态都记在 Context Window 里，而是利用<strong>文件系统</strong>进行 Context Offloading（上下文卸载）。文件系统成为了 Agent 的外挂memory（不同于compact的有损压缩，Offloading是无损的）</p>
</li>
<li>
<p><strong>Anthropic 的 &ldquo;Programming tool-using&rdquo; 和skills</strong>：由agent自身编写代码实现tool-call相比于直接的tool-call能够节约大量context；同时agent skills本质上也是利用了file-system，对宝贵的context 进行节约的设计</p>
</li>
</ul>
<p>显而易见，<strong>代码执行环境 (Code Execution)</strong> 和 <strong>可读写的文件系统 (File System)</strong> 已经超越了辅助工具的范畴，成为 Agent 组件中必要且不可或缺的部分。</p>
<p>しかし赋予 Agent “写代码”和“改文件”的能力，等同于赋予了它巨大的破坏力。</p>
<p>与传统软件确定的执行路径不同，Agent 的行为是基于概率和上下文动态生成的</p>
<p>意味着：</p>
<ul>
<li>
<p><strong>Prompt Injection</strong></p>
</li>
<li>
<p>Agent 的幻觉导致死循环或资源耗尽</p>
</li>
</ul>
<p>因此，通过为 Agent 划定严格的 <strong>安全边界（Sandbox）</strong>——如网络隔离、文件系统隔离、进程隔离，便显得尤为重要。</p>
<p>此外与 Claude Code 这样跑在开发者本地电脑上的 Coding Agent 不同，开发者通常拥有把控风险的能力（虽然在 &ldquo;YOLO 模式&rdquo; 下误删文件的事故屡见不鲜）；对于部署在云端的 Agent 服务，这两者存在着信任边界的差异，用户不希望为 Agent 的每一次执行 点击“批准”，<strong>只要 Agent 在sandbox内折腾，它就是安全的</strong>；</p>
<h2 id="技术实现比较">技术实现比较<a hidden class="anchor" aria-hidden="true" href="#技术实现比较">#</a></h2>
<table>
  <thead>
      <tr>
          <th style="text-align: left">技术方案</th>
          <th style="text-align: left">核心原理</th>
          <th style="text-align: left">启动速度</th>
          <th style="text-align: left">隔离强度</th>
          <th style="text-align: left">典型适用场景</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><strong>Local Runtime</strong></td>
          <td style="text-align: left">OS 原语 (bubblewrap)</td>
          <td style="text-align: left">极快 (ms级)</td>
          <td style="text-align: left">低</td>
          <td style="text-align: left">本地开发、CLI 工具</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>WASM</strong></td>
          <td style="text-align: left">字节码沙箱</td>
          <td style="text-align: left">微秒级</td>
          <td style="text-align: left">中</td>
          <td style="text-align: left">简单的纯计算任务</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>Docker (Standard)</strong></td>
          <td style="text-align: left">进程级 (Cgroups/NS)</td>
          <td style="text-align: left">快 (s级)</td>
          <td style="text-align: left">中</td>
          <td style="text-align: left">通用任务，需深度加固</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>gVisor</strong></td>
          <td style="text-align: left">内核模拟 (Sentry)</td>
          <td style="text-align: left">中 (s级)</td>
          <td style="text-align: left">高</td>
          <td style="text-align: left">多租户、不可信代码执行</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>MicroVM (Firecracker)</strong></td>
          <td style="text-align: left">硬件虚拟化 (KVM)</td>
          <td style="text-align: left">极快 (~125ms)</td>
          <td style="text-align: left">极高</td>
          <td style="text-align: left">公有云、高密度 Agent 托管</td>
      </tr>
  </tbody>
</table>
<p>从技术实现角度，现阶段的Sandbox有以下几种实现方式</p>
<h3 id="local-sandbox-runtime">Local Sandbox-runtime<a hidden class="anchor" aria-hidden="true" href="#local-sandbox-runtime">#</a></h3>
<p>其原理利用 Linux 的 <code>namespaces</code> 和 <code>cgroups</code> 或 macOS 的 <code>sandbox-exec</code> 等操作系统原语直接限制进程权限， 如限制对配置路径的读/写访问，通过内置代理路由网络流量。</p>
<ul>
<li>
<p><strong>优点</strong>：极轻量，无镜像拉取开销，适合用户的本地开发环境。</p>
</li>
<li>
<p><strong>缺点</strong>：依赖宿主内核，如果内核存在漏洞，恶意代码可能逃逸。</p>
</li>
</ul>
<p>如 Claude Code 中 执行 <code>/sandbox</code></p>
<p>可在 <strong><code>.claude/settings.json</code></strong> 中配置对应的权限：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;sandbox&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;enabled&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;autoAllowBashIfSandboxed&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;excludedCommands&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;git&#34;</span><span class="p">,</span> <span class="s2">&#34;docker&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;network&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;allowUnixSockets&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;/var/run/docker.sock&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;allowLocalBinding&#34;</span><span class="p">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>本质上，Claude Code 的 <strong>sandbox runtime 是一个 OS 级别的“受限 Bash 运行环境”。</strong></p>
<p>对 Claude code 发出的 bash 命令及其所有子进程统一施加：</p>
<ul>
<li>
<p><strong>文件系统隔离</strong>（只允许访问/写入你事先配置的目录）；</p>
</li>
<li>
<p><strong>网络隔离</strong>（只允许访问你事先配置的域名/IP，通常通过本地 proxy/过滤实现）</p>
</li>
</ul>
<p>好消息是，Anthropic 将这个sandbox开源了，通过：</p>
<p><code>npx @anthropic-ai/sandbox-runtime &lt;command-to-sandbox&gt;</code>使用，不只只能给CC使用的，也可用于自己的agent项目中，通过MCP的方式配置使用。</p>
<p>具体可见：<a href="https://github.com/anthropic-experimental/sandbox-runtime">anthropic-experimental/sandbox-runtime</a></p>
<p>不过，macOS 的 <code>sandbox-exec</code>  基本上处于废弃状态，建议谨慎使用。</p>
<h3 id="webassembly-wasm">WebAssembly (WASM)<a hidden class="anchor" aria-hidden="true" href="#webassembly-wasm">#</a></h3>
<p>WASM 最初是为浏览器设计的，天生具有沙箱属性。</p>
<p>WASM 将代码编译成通用的二进制格式（<code>.wasm</code>）。Runtime 会像显微镜一样检查每一条指令，确保它只能访问分配给它的那块内存数组。越界访问会被立即掐断。</p>
<p>WASM 的冷启动时间极快， 成本低，适合执行简单逻辑的场景。</p>
<p>但其生态兼容性是最大痛点。虽然 Python 可以编译为 WASM (Pyodide)，但许多依赖 C 扩展的库（如 Pandas, NumPy, Scipy 的某些部分）支持尚不完善，且网络栈受限</p>
<h3 id="docker">Docker<a hidden class="anchor" aria-hidden="true" href="#docker">#</a></h3>
<p>默认的 Docker 是不安全的，在标准 Docker 中，容器只是宿主机上的一个<strong>进程</strong>。</p>
<p>存在容器逃逸的问题： Linux 内核由数千万行代码组成，不可避免地存在 Bug（漏洞）。如果 Agent 发送了一个精心构造的“恶意系统调用”触发了内核漏洞（Kernel Panic 或 提权漏洞），它就能<strong>瞬间逃出容器</strong>，直接控制整台宿主机。</p>
<p>因此必须进行安全加固。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker run <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --cap-drop ALL <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --security-opt no-new-privileges <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --security-opt <span class="nv">seccomp</span><span class="o">=</span>/path/to/seccomp-profile.json <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --read-only <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --tmpfs /tmp:rw,noexec,nosuid,size<span class="o">=</span>100m <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --tmpfs /home/agent:rw,noexec,nosuid,size<span class="o">=</span>500m <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --network none <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --memory 2g <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --cpus <span class="m">2</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --pids-limit <span class="m">100</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --user 1000:1000 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -v /path/to/code:/workspace:ro <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -v /var/run/proxy.sock:/var/run/proxy.sock:ro <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  agent-image
</span></span></code></pre></div><p>关键配置包括移除 Linux capabilities、只读文件系统、禁用网络接口等</p>
<table>
  <thead>
      <tr>
          <th style="text-align: left"><strong>选项</strong></th>
          <th style="text-align: left"><strong>目的</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><code>--cap-drop ALL</code></td>
          <td style="text-align: left">删除 Linux 功能，如 <code>NET_ADMIN</code> 和 <code>SYS_ADMIN</code>，这些功能可能导致权限提升</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--security-opt no-new-privileges</code></td>
          <td style="text-align: left">防止进程通过 setuid 二进制文件获得权限</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--security-opt seccomp=...</code></td>
          <td style="text-align: left">限制可用的系统调用；Docker 的默认值阻止约 44 个，自定义配置文件可以阻止更多</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--read-only</code></td>
          <td style="text-align: left">使容器的根文件系统不可变，防止代理持久化更改</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--tmpfs /tmp:...</code></td>
          <td style="text-align: left">提供一个可写的临时目录，在容器停止时清除</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--network none</code></td>
          <td style="text-align: left">删除所有网络接口；代理通过下面挂载的 Unix 套接字进行通信</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--memory 2g</code></td>
          <td style="text-align: left">将内存使用限制为 2GB 以防止资源耗尽</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--pids-limit 100</code></td>
          <td style="text-align: left">限制进程数以防止 fork 炸弹</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--user 1000:1000</code></td>
          <td style="text-align: left">以非 root 用户身份运行</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>-v ...:/workspace:ro</code></td>
          <td style="text-align: left">以只读方式挂载代码，以便代理可以分析但不能修改。<strong>避免挂载敏感的主机目录，如 <code>~/.ssh</code>、<code>~/.aws</code> 或 <code>~/.config</code></strong></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>-v .../proxy.sock:...</code></td>
          <td style="text-align: left">挂载连接到在容器外运行的代理的 Unix 套接字</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--userns-remap</code></td>
          <td style="text-align: left">将容器 root 映射到非特权主机用户；需要守护程序配置，但限制容器逃逸造成的损害</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>--ipc private</code></td>
          <td style="text-align: left">隔离进程间通信以防止跨容器攻击</td>
      </tr>
  </tbody>
</table>
<p>（from <a href="https://platform.claude.com/docs/en/agent-sdk/secure-deployment#containers">Claude: Securely deploying AI agents</a>）</p>
<h3 id="gvisor">gVisor<a hidden class="anchor" aria-hidden="true" href="#gvisor">#</a></h3>
<p>标准docker容器共享主机内核，这意味着内核漏洞可能允许容器逃逸。</p>
<p>gVisor 通过在用户空间中拦截系统调用来解决这个问题，然后才到达主机内核，实现自己的兼容性层来处理大多数系统调用，而无需涉及真实内核。</p>
<p>简单来说，使用 gVisor，攻击面要小得多，恶意代码首先需要利用 gVisor 的用户空间实现，并且对真实内核的访问有限。不信任容器内的进程，不让它们直接接触真内核。</p>
<p><strong>流程对比：</strong></p>
<ul>
<li>
<p><strong>Docker:</strong> Agent -&gt; Syscall -&gt; <strong>宿主机真内核</strong></p>
</li>
<li>
<p><strong>gVisor:</strong> Agent -&gt; Syscall -&gt; <strong>Sentry (伪内核)</strong> -&gt; (检查并过滤) -&gt; 必要的 Syscall -&gt; <strong>宿主机真内核</strong></p>
</li>
</ul>
<p>要将 gVisor 与 Docker 一起使用，安装 <code>runsc</code> 运行时并配置守护程序：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">// /etc/docker/daemon.json
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;runtimes&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;runsc&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;path&#34;</span>: <span class="s2">&#34;/usr/local/bin/runsc&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>运行容器：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker run --runtime<span class="o">=</span>runsc agent-image
</span></span></code></pre></div><table>
  <thead>
      <tr>
          <th style="text-align: left"><strong>工作负载</strong></th>
          <th style="text-align: left"><strong>开销</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">CPU 密集型计算</td>
          <td style="text-align: left">~0%（无系统调用拦截）</td>
      </tr>
      <tr>
          <td style="text-align: left">简单系统调用</td>
          <td style="text-align: left">~2 倍慢</td>
      </tr>
      <tr>
          <td style="text-align: left">文件 I/O 密集型</td>
          <td style="text-align: left">对于繁重的打开/关闭模式，最多慢 10-200 倍</td>
      </tr>
  </tbody>
</table>
<p>计算密集型任务（如矩阵运算）几乎无损耗，但系统调用密集型任务（如大量小文件读写、网络请求）损耗显著， 对于多租户环境或处理不受信任的内容时，额外的隔离通常值得开销。</p>
<h3 id="microvm">MicroVM<a hidden class="anchor" aria-hidden="true" href="#microvm">#</a></h3>
<p>MicroVM 其的核心逻辑，是为了解决 Docker 无法解决的根本性矛盾：既要像容器一样快，又要像物理机一样安全。</p>
<p>AWS 在 2018 年开源了 Firecracker，专为 Serverless 和多租户容器设计: 砍掉了传统虚拟机（如 QEMU）中 90% 对 Agent 无用的功能，只保留了 CPU、内存、网络和最基础的块设备， 因而带来了惊人的性能，<strong>约 125 毫秒</strong>的冷启动时间，内存开销不到 5 MiB。</p>
<p>因此成为了目前公有云Sandbox 服务商，如E2B、Modal的底层标准技术。</p>
<p>除了Firecracker以外：</p>
<ul>
<li>
<p>QEMU (Traditional VM)：功能更强但启动慢、内存占用高</p>
</li>
<li>
<p>Kata Containers：对外暴露 Docker/K8s 的操作接口，但对内它会启动一个轻量级虚拟机（支持调用 QEMU 或 Firecracker）来包裹容器</p>
</li>
</ul>
<h2 id="如何选择-分类维度">如何选择： 分类维度<a hidden class="anchor" aria-hidden="true" href="#如何选择-分类维度">#</a></h2>
<p>从工程落地角度，可以在以下几个维度做出权衡。</p>
<h3 id="自托管-self-hosting-vs-云服务-managed-provider">自托管 (Self-hosting) vs 云服务 (Managed Provider)<a hidden class="anchor" aria-hidden="true" href="#自托管-self-hosting-vs-云服务-managed-provider">#</a></h3>
<p>并非所有企业的数据隐私要求都能够接受云托管的sandbox。拥有成熟运维团队的前提下，基于 Hardened Docker、gVisor 或 Kata Containers 自建集群都是不错的选择。</p>
<p>当然，云托管解决了Firecracker 极度复杂的网络配置和资源调度，也让开发者能够将精力放在开发和快速验证上，更何况如E2B之类的sandbox服务商，已是不少agent项目（Manus、Perplexity等）的底层技术的一环。</p>
<h3 id="long-running-vs-high-frequency-lifecycle-persistence">Long running vs High-frequency (Lifecycle， <strong>persistence)</strong><a hidden class="anchor" aria-hidden="true" href="#long-running-vs-high-frequency-lifecycle-persistence">#</a></h3>
<p>现阶段的sandbox的最主要用途，还是 code Interpreter，如执行agent生成的代码、数据分析等。</p>
<p>对于大多数情况下，用完即焚，每次请求启动一个全新环境，任务结束立即销毁。同时通过预装环境的sandbox（常用数据分析库）也可节约响应时间。</p>
<p>在如Agent skills所需要file-system的场景下，持久化则显得很重要。像E2B也支持了一定时间内（30天内）的持久化：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">e2b_code_interpreter</span> <span class="kn">import</span> <span class="n">Sandbox</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sandbox</span> <span class="o">=</span> <span class="n">Sandbox</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>  <span class="c1"># Starts in Running state</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Pause the sandbox</span>
</span></span><span class="line"><span class="cl"><span class="n">sandbox</span><span class="o">.</span><span class="n">betaPause</span><span class="p">()</span>  <span class="c1"># Running → Paused</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Resume the sandbox</span>
</span></span><span class="line"><span class="cl"><span class="n">sandbox</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>  <span class="c1"># Running/Paused → Running</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Kill the sandbox (from any state)</span>
</span></span><span class="line"><span class="cl"><span class="n">sandbox</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>  <span class="c1"># Running/Paused → Killed</span>
</span></span></code></pre></div><p><img loading="lazy" src="https://mintcdn.com/e2b/bga6ifW6jAKoRCaG/images/diagram.png?w=1650&amp;fit=max&amp;auto=format&amp;n=bga6ifW6jAKoRCaG&amp;q=85&amp;s=04e0ffe5772a64cb8815ae92b0cabbed" alt=""  />
</p>
<h3 id="serving-vs-agentic-rl-rollout">Serving vs Agentic RL Rollout<a hidden class="anchor" aria-hidden="true" href="#serving-vs-agentic-rl-rollout">#</a></h3>
<p>不同业务场景下的并发密度和Isolation要求不同。</p>
<p>User-facing Serving： 核心关注点在多租户隔离和响应延迟；因而，Firecracker 或 gVisor成为首选，同时通过Warm Pool预热机制以最大程度降低冷启动延迟。</p>
<p>Training &amp; Data Gen： 这时候考虑的是Throughput和Cost；需要 Agent 在 Sandbox 中并行执行数万次代码，以生成用于 RLVR算法的奖励数据（Rollout）；此时docker已经足够（如 <a href="https://verl.readthedocs.io/en/latest/examples/sandbox_fusion_example.html">sandbox fusion</a>）</p>
<h3 id="text-only-vs-gui-computer-use--browser">Text-only vs GUI (Computer Use &amp; Browser)<a hidden class="anchor" aria-hidden="true" href="#text-only-vs-gui-computer-use--browser">#</a></h3>
<p>Text-only (Code Interpreter)： 标准的 REPL 环境，仅涉及 <code>stdin/stdout</code> 和文件读写，基于轻量级 Linux 发行版和极低的资源消耗；</p>
<p>GUI / Computer Use (Browser-using)： 需要VNC提供实时截屏于VLM，意味着更大的资源要求，和更复杂的数据传输；常见如<code>[browserbase](https://www.browserbase.com/)</code>, <a href="https://github.com/steel-dev/steel-browser">steel-browser</a></p>
<h2 id="主流-sandbox-方案汇总">主流 Sandbox 方案汇总<a hidden class="anchor" aria-hidden="true" href="#主流-sandbox-方案汇总">#</a></h2>
<p>通用sandbox（云服务）</p>
<ul>
<li>
<p><a href="https://e2b.dev/">E2B</a></p>
</li>
<li>
<p><a href="https://modal.com/products/sandboxes">model sandboxes</a></p>
</li>
<li>
<p><a href="https://www.daytona.io/">daytona</a></p>
</li>
<li>
<p><a href="https://docs.agent.run/docs/tutorial/overview">AgentRun</a></p>
</li>
<li>
<p><a href="https://docs.runloop.ai/docs/overview/what-is-runloop">Runloop</a></p>
</li>
<li>
<p><a href="https://developers.cloudflare.com/sandbox/">cloudflare-sandbox</a></p>
</li>
<li>
<p><a href="https://vercel.com/docs/vercel-sandbox">vercel-sandbox</a></p>
</li>
</ul>
<p>轻量级（开源）</p>
<ul>
<li>
<p><a href="https://github.com/boxlite-ai/boxlite">BoxLite</a></p>
</li>
<li>
<p><a href="https://github.com/zerocore-ai/microsandbox">Microsandbox</a></p>
</li>
<li>
<p><a href="https://github.com/anthropic-experimental/sandbox-runtime">anthropic-experimental/sandbox-runtime</a></p>
</li>
<li>
<p><a href="https://github.com/agent-infra/sandbox">agent-infra/sandbox</a></p>
</li>
</ul>
<p>Browser-using</p>
<ul>
<li>
<p><a href="https://github.com/steel-dev/steel-browser">steel-browser</a></p>
</li>
<li>
<p><a href="https://www.browserbase.com/">Browserbase</a></p>
</li>
<li>
<p><a href="https://docs.browser-use.com/customize/sandbox/quickstart">browser-use-sandbox</a></p>
</li>
</ul>
<h2 id="结语">结语<a hidden class="anchor" aria-hidden="true" href="#结语">#</a></h2>
<p>起初OpenAI Code Interpreter 的出现， 需要一个安全的 Sandbox 来执行它生成的 Python 代码，仅仅为了弥补数学计算和逻辑执行的短板。</p>
<p>随后， 随着 Context Engineering 的深入，Manus 和 Anthropic 的实践告诉我们，Sandbox 里的 File System 不再只是存临时文件的地方，它是 Agent 的memory，于是Sandbox 变成了 Agent Skills 和Memory 的载体。</p>
<p><strong>那么未来？是 Agent Using Sandbox，还是 Agent Inside Sandbox？</strong></p>
<h2 id="参考">参考<a hidden class="anchor" aria-hidden="true" href="#参考">#</a></h2>
<p><a href="https://www.anthropic.com/engineering/claude-code-sandboxing">Beyond permission prompts: making Claude Code more secure and autonomous</a></p>
<p><a href="https://code.claude.com/docs/en/sandboxing">Claude Code: Sandboxing</a></p>
<p><a href="https://platform.claude.com/docs/en/agent-sdk/secure-deployment">Securely deploying AI agents</a></p>
<p><a href="https://huggingface.co/docs/smolagents/v1.23.0/en/tutorials/secure_code_execution#local-code-execution">smolagents: Secure code execution</a></p>
<p><a href="https://billxbf.github.io/posts/demystify-agent-sandbox/">Demystifying Agent Sandbox</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://niraya666.github.io/tags/agent-infra/">Agent-Infra</a></li>
      <li><a href="https://niraya666.github.io/tags/agent/">Agent</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://niraya666.github.io/posts/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E5%8F%AF%E9%9D%A0%E7%9A%84-ai-agent-%E8%AF%84%E4%BC%B0%E4%BD%93%E7%B3%BB-%E8%AF%BB-anthropic-%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2%E6%9C%89%E6%84%9F/">
    <span class="title">Next »</span>
    <br>
    <span>如何构建可靠的 Agent 评估体系：读 Anthropic 技术博客有感</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Agent Infra: sandbox技术和选型 on x"
            href="https://x.com/intent/tweet/?text=Agent%20Infra%3a%20sandbox%e6%8a%80%e6%9c%af%e5%92%8c%e9%80%89%e5%9e%8b&amp;url=https%3a%2f%2fniraya666.github.io%2fposts%2fagent-infra-sandbox%25E6%258A%2580%25E6%259C%25AF%25E5%2592%258C%25E9%2580%2589%25E5%259E%258B%2f&amp;hashtags=Agent-Infra%2cAgent">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Agent Infra: sandbox技术和选型 on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fniraya666.github.io%2fposts%2fagent-infra-sandbox%25E6%258A%2580%25E6%259C%25AF%25E5%2592%258C%25E9%2580%2589%25E5%259E%258B%2f&amp;title=Agent%20Infra%3a%20sandbox%e6%8a%80%e6%9c%af%e5%92%8c%e9%80%89%e5%9e%8b&amp;summary=Agent%20Infra%3a%20sandbox%e6%8a%80%e6%9c%af%e5%92%8c%e9%80%89%e5%9e%8b&amp;source=https%3a%2f%2fniraya666.github.io%2fposts%2fagent-infra-sandbox%25E6%258A%2580%25E6%259C%25AF%25E5%2592%258C%25E9%2580%2589%25E5%259E%258B%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Agent Infra: sandbox技术和选型 on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fniraya666.github.io%2fposts%2fagent-infra-sandbox%25E6%258A%2580%25E6%259C%25AF%25E5%2592%258C%25E9%2580%2589%25E5%259E%258B%2f&title=Agent%20Infra%3a%20sandbox%e6%8a%80%e6%9c%af%e5%92%8c%e9%80%89%e5%9e%8b">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Agent Infra: sandbox技术和选型 on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fniraya666.github.io%2fposts%2fagent-infra-sandbox%25E6%258A%2580%25E6%259C%25AF%25E5%2592%258C%25E9%2580%2589%25E5%259E%258B%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Agent Infra: sandbox技术和选型 on whatsapp"
            href="https://api.whatsapp.com/send?text=Agent%20Infra%3a%20sandbox%e6%8a%80%e6%9c%af%e5%92%8c%e9%80%89%e5%9e%8b%20-%20https%3a%2f%2fniraya666.github.io%2fposts%2fagent-infra-sandbox%25E6%258A%2580%25E6%259C%25AF%25E5%2592%258C%25E9%2580%2589%25E5%259E%258B%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Agent Infra: sandbox技术和选型 on telegram"
            href="https://telegram.me/share/url?text=Agent%20Infra%3a%20sandbox%e6%8a%80%e6%9c%af%e5%92%8c%e9%80%89%e5%9e%8b&amp;url=https%3a%2f%2fniraya666.github.io%2fposts%2fagent-infra-sandbox%25E6%258A%2580%25E6%259C%25AF%25E5%2592%258C%25E9%2580%2589%25E5%259E%258B%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Agent Infra: sandbox技术和选型 on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Agent%20Infra%3a%20sandbox%e6%8a%80%e6%9c%af%e5%92%8c%e9%80%89%e5%9e%8b&u=https%3a%2f%2fniraya666.github.io%2fposts%2fagent-infra-sandbox%25E6%258A%2580%25E6%259C%25AF%25E5%2592%258C%25E9%2580%2589%25E5%259E%258B%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
<div id="utterances">
  <script src="https://utteranc.es/client.js"
        repo="Niraya666/niraya666.github.io"
        issue-term="pathname"
        theme="preferred-color-scheme"
        crossorigin="anonymous"
        async>
  </script>
</div>


<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      packages: {'[+]': ['ams']}
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>


</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2026 <a href="https://niraya666.github.io/">LZY Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
